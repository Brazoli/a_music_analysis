#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Análise das músicas
Created on Fri Mar 17 08:34:32 2017
@author: leonardosales
"""
### Pacotes
from nltk.corpus import stopwords
import nltk
#nltk.download()
from unidecode import unidecode
import numpy as np
stop = stopwords.words('portuguese')
from collections import Counter
import pandas as pd
import urllib.request as urllib  # copia paginas html


### Parte 1: Letras
    

# Tratando terminacoes de linha
df_analise_letras_amostra["letra_limpa"] = ""
df_analise_letras_amostra.loc[:,"letra_limpa"] = df_analise_letras_amostra["letra"].str.replace(",","").str.replace("  "," ").str.replace("  "," ").str.replace("  "," ").str.replace("  "," ").str.replace("|","| ").str.replace("  "," ").str.replace(" \|","|")

df_analise_letras["letra_limpa"] = ""
df_analise_letras.loc[:,"letra_limpa"] = df_analise_letras["letra"].str.replace(",","").str.replace("  "," ").str.replace("  "," ").str.replace("  "," ").str.replace("  "," ").str.replace("|","| ").str.replace("  "," ").str.replace(" \|","|")

# Removendo stop words
df_analise_letras_amostra["letra_limpa"] = df_analise_letras_amostra["letra_limpa"].str.lower().str.split()
df_analise_letras_amostra["letra_limpa_2"] = df_analise_letras_amostra["letra_limpa"].apply(lambda x: [item for item in x if item not in stop])

df_analise_letras["letra_limpa"] = df_analise_letras["letra_limpa"].str.lower().str.split()
df_analise_letras["letra_limpa_2"] = df_analise_letras["letra_limpa"].apply(lambda x: [item for item in x if item not in stop])


# Removendo acentuação
# Funcao para remover acentos
def remove_acentos(x):
    y = []
    for j in x:
        y.append(unidecode(j))
    return y
# Executando    
df_analise_letras_amostra["letra_limpa_3"] = df_analise_letras_amostra["letra_limpa_2"].map(remove_acentos)

df_analise_letras["letra_limpa_3"] = df_analise_letras["letra_limpa_2"].map(remove_acentos)

# Criando lista com as endlines e outra com terminacoes.
df_analise_letras_amostra["letra_endlines"] = df_analise_letras_amostra["letra_limpa_3"].apply(lambda x: [item for item in x if "|" in item])

def terminacoes(x):
    y = []
    for j in x:
        j = j.replace("|","").replace(".","").replace("!","").replace(";","").replace("?","")
        y.append(j[-3:])
    y = [x for x in y if x != "" and len(x) > 2]
    return y

df_analise_letras_amostra["letra_terminacoes"] = df_analise_letras_amostra["letra_endlines"].map(terminacoes)
df_analise_letras_amostra["letra_terminacoes_full"] = df_analise_letras_amostra["letra_limpa_3"].map(terminacoes)


df_analise_letras["letra_endlines"] = df_analise_letras["letra_limpa_3"].apply(lambda x: [item for item in x if "|" in item])

df_analise_letras["letra_terminacoes"] = df_analise_letras["letra_endlines"].map(terminacoes)
df_analise_letras["letra_terminacoes_full"] = df_analise_letras["letra_limpa_3"].map(terminacoes)


# Criando lista com todas as palavras da língua portuguesa
file = "preao2.txt"
lista_palavras_pt = []
for line in open(file, encoding="UTF-8"):
    lista_palavras_pt.append(unidecode(line).replace("\n",""))
    
# Criando coluna com termos da letra que constam do vocabulário em pt
def replace(x):
    y = []
    for j in x:
        j = j.replace("|","").replace(".","").replace("!","").replace(";","").replace("?","").replace("\"","").replace(")","").replace("(","").replace("\[","").replace("\]","").replace("\'","").replace(":","").replace("/","").replace("3x","").replace("2x","").replace("4x","").replace("1x","")
        y.append(j)
    y = [x for x in y if x != ""]
    return y

df_analise_letras_amostra["letra_limpa_4"] = df_analise_letras_amostra["letra_limpa_3"].map(replace)
df_analise_letras["letra_limpa_4"] = df_analise_letras["letra_limpa_3"].map(replace)


palavras = []
for i in range(0,len(df_analise_letras)):
    for j in range(0,len(df_analise_letras.iloc[i]["letra_limpa_4"])):
        palavras.append(df_analise_letras.iloc[i]["letra_limpa_4"][j])
    print(i)

palavras = list(set(palavras))
lista_palavras_pt_2 = list(set(palavras).intersection(lista_palavras_pt))
palavras_fora = list(set(palavras)-set(lista_palavras_pt_2))

def vocabulario(x):
    y = list(set(x).intersection(lista_palavras_pt_2))
    return y
 

df_analise_letras_amostra["letra_vocabulario"] = df_analise_letras_amostra["letra_limpa_4"].map(vocabulario)

df_analise_letras["letra_vocabulario"] = df_analise_letras["letra_limpa_4"].map(vocabulario)

df_analise_letras['letra_vocabulario_full'] = np.empty((len(df_analise_letras), 0)).tolist()
for i in range(0, len(df_analise_letras)):
    vocabulario = df_analise_letras.iloc[i]["letra_vocabulario"]
    letra = df_analise_letras.iloc[i]["letra_limpa_4"]
    df_analise_letras["letra_vocabulario_full"][i] = [j for j in letra if j in vocabulario]
    print(i)


# Criando colunas: qtde de palavras, palavras distintas, terminacoes, terminacoes distintas e rimas.
def tamanho_lista(x):
    return len(x)

def tamanho_lista_unicos(x):
    return len(set(x))


df_analise_letras['qtde_palavras'] = df_analise_letras['letra_vocabulario_full'].map(tamanho_lista)
df_analise_letras['qtde_palavras_distintas'] = df_analise_letras['letra_vocabulario'].map(tamanho_lista)
df_analise_letras['qtde_terminacoes_endlines'] = df_analise_letras["letra_terminacoes"].map(tamanho_lista)
df_analise_letras['qtde_terminacoes_endlines_unicas'] = df_analise_letras["letra_terminacoes"].map(tamanho_lista_unicos)
df_analise_letras['qtde_terminacoes_geral'] = df_analise_letras["letra_terminacoes_full"].map(tamanho_lista)
df_analise_letras['qtde_terminacoes_geral_unicas'] = df_analise_letras["letra_terminacoes_full"].map(tamanho_lista_unicos)
df_analise_letras["qtde_rimas_endlines"] = df_analise_letras['qtde_terminacoes_endlines'] - df_analise_letras['qtde_terminacoes_endlines_unicas']
df_analise_letras["qtde_rimas_geral"] = df_analise_letras['qtde_terminacoes_geral'] - df_analise_letras['qtde_terminacoes_geral_unicas']


# Criando lista com todas as palavras da língua inglesa
file = "english.txt"
lista_palavras_en = []
for line in open(file):
    lista_palavras_en.append(unidecode(line).replace("\n",""))

def vocabulario_en(x):
    y = list(set(x).intersection(lista_palavras_en))
    return y

# eliminando alta proporcao de ingles
df_analise_letras["letra_vocabulario_en"] = df_analise_letras["letra_limpa_4"].map(vocabulario_en)
df_analise_letras["letra_proporcao_en"] = df_analise_letras["letra_vocabulario_en"].map(tamanho_lista)/df_analise_letras["letra_limpa_4"].map(tamanho_lista)
df_analise_letras = df_analise_letras[df_analise_letras["letra_proporcao_en"] < 0.3]

# eliminando baixa proporcao de portugues, artistas em ingles, menos que 10 palavras e menos que 5 distintas
df_analise_letras["letra_proporcao_pt"] = df_analise_letras["letra_vocabulario_full"].map(tamanho_lista)/df_analise_letras["letra_limpa_4"].map(tamanho_lista)
df_analise_letras_amostra2 = df_analise_letras.iloc[:, [0,1,15,16,30,31]]
df_analise_letras_amostra2.to_csv('df_analise_letras_amostra2.csv', sep=';')
df_analise_letras_filtrado = df_analise_letras[~df_analise_letras["artista"].isin(["catolicas","high-school-musical","hinario-adventista","musicas-infantis"])]
df_analise_letras_filtrado = df_analise_letras_filtrado[df_analise_letras_filtrado["qtde_palavras"] > 9]
df_analise_letras_filtrado = df_analise_letras_filtrado[df_analise_letras_filtrado["qtde_palavras_distintas"] > 4]
df_analise_letras_filtrado = df_analise_letras_filtrado[df_analise_letras_filtrado["letra_proporcao_pt"] > 0.3999999999999999]


# Calculando o idf medio para cada letra
df_analise_letras_amostra = df_analise_letras.iloc[:100]
palavras_geral = []
for i in range(0,len(df_analise_letras_filtrado)):
    for j in range(0,len(df_analise_letras_filtrado.iloc[i]["letra_vocabulario_full"])):
        palavras_geral.append(df_analise_letras_filtrado.iloc[i]["letra_vocabulario_full"][j])
    print(i)

palavras_geral_dict = dict(Counter(palavras_geral))

def count_word(x):
    y = []    
    for j in x:
        count = palavras_geral_dict.get(j)
        y.append(count)
    return y

def count_word_intra(x):
    y = []    
    for j in x:
        count = x.count(j)
        y.append(count)
    return y

def coluna_array(x):
    y = np.asarray(x)
    return y

def array_mean(x):
    y = x.mean()
    return y

df_analise_letras_filtrado["vocabulario_full_idf"] = df_analise_letras_filtrado["letra_vocabulario_full"].map(count_word)
df_analise_letras_filtrado["vocabulario_full_tf"] = df_analise_letras_filtrado["letra_vocabulario_full"].map(count_word_intra)
df_analise_letras_filtrado["vocabulario_full_idf_array"] = df_analise_letras_filtrado["vocabulario_full_idf"].map(coluna_array)
df_analise_letras_filtrado["vocabulario_full_tf_array"] = df_analise_letras_filtrado["vocabulario_full_tf"].map(coluna_array)
df_analise_letras_filtrado["vocabulario_full_tf_idf_array"] = df_analise_letras_filtrado["vocabulario_full_tf_array"]/df_analise_letras_filtrado["vocabulario_full_idf_array"]
df_analise_letras_filtrado['vocabulario_full_tf_idf_mean'] = df_analise_letras_filtrado["vocabulario_full_tf_idf_array"].map(array_mean)

#df_analise_letras_chico = df_analise_letras[df_analise_letras['artista'] == "chico-buarque"]

### Parte 2: Cifras
# limpeza: transformando a cifra em uma lista de acordes
def str_to_list(x):
    y = x.replace("\'","").replace(" ","").replace("[","").replace("]","").split(",")
    return y

df_analise_cifras["cifra_list"] = df_analise_cifras["cifra"].map(str_to_list)

# limpeza: criando lista com toods os acordes
lista_acordes = []
for i in range(0,len(df_analise_cifras)):
    for j in range(0,len(df_analise_cifras.iloc[i]["cifra_list"])):
        lista_acordes.append(df_analise_cifras.iloc[i]["cifra_list"][j])
    print(i)

count_cifra = Counter(lista_acordes)
df_cifras_count = pd.DataFrame.from_dict(count_cifra, orient='index').reset_index()
df_cifras_count.to_csv('df_cifras_count.csv', sep=';')

# limpeza: criando lista de acordes inválidos
lista_acordes_unicos = list(set(lista_acordes))
def verifica_acorde(acorde, file):
    line_number = 0
    for line in open(file, encoding="ISO-8859-1"):
        line_number += 1
        if line_number == 125 and "understood" in line:
            invalido = acorde
            return (invalido)


lista_acordes_invalidos = [""]
for i in range(0,len(lista_acordes_unicos)):
    try:
        acorde = lista_acordes_unicos[i]
        acorde_page = ("http://jguitar.com/chordsearch?chordsearch="+acorde+"&labels=none")
        file = "acorde.txt"
        urllib.urlretrieve(acorde_page, file)
        lista_acordes_invalidos.append(verifica_acorde(acorde, file))
        percent = i*100/len(lista_acordes_unicos)
        print(percent)
    except:
        pass
    
lista_acordes_invalidos.remove(None)
lista_acordes_invalidos = [x for x in lista_acordes_invalidos if x is not None]
df_acordes_invalidos = pd.DataFrame({'invalidos': lista_acordes_invalidos})
df_acordes_invalidos.to_csv('df_acordes_invalidos.csv', sep=';')
lista_indice_acordes_invalidos = [8725,8724,8721,8720,8716,8715,8713,8712,8708,8707,8706,8705,8704,8702,8701,8699,8697,8696,8695,8693,8692,8691,8686,8685,8684,8681,8680,8679,8678,8677,8676,8675,8672,8670,8669,8668,8667,8666,8665,8664,8663,8662,8661,8660,8654,8653,8652,8650,8648,8644,8643,8641,8638,8637,8635,8634,8633,8630,8627,8626,8625,8624,8623,8621,8618,8617,8615,8614,8613,8612,8611,8610,8609,8607,8606,8605,8602,8601,8600,8599,8596,8595,8592,8591,8590,8589,8588,8587,8586,8585,8583,8582,8581,8580,8579,8578,8575,8574,8573,8572,8571,8569,8568,8567,8566,8565,8564,8563,8560,8559,8558,8557,8556,8555,8554,8553,8551,8550,8549,8548,8547,8546,8544,8543,8542,8541,8540,8539,8538,8536,8535,8533,8532,8530,8529,8527,8526,8525,8524,8523,8522,8521,8518,8517,8516,8515,8514,8513,8508,8507,8499,8497,8496,8495,8494,8493,8492,8491,8490,8489,8488,8487,8486,8485,8484,8483,8482,8481,8479,8477,8475,8473,8472,8469,8467,8465,8464,8463,8462,8461,8460,8459,8452,8448,8447,8446,8445,8444,8443,8442,8441,8440,8439,8438,8437,8436,8435,8429,8428,8427,8426,8425,8423,8422,8421,8420,8417,8412,8411,8410,8409,8404,8403,8402,8401,8400,8395,8394,8393,8392,8391,8390,8389,8387,8386,8385,8382,8381,8380,8378,8377,8376,8374,8372,8371,8369,8367,8366,8365,8364,8363,8362,8361,8360,8359,8358,8357,8356,8355,8354,8353,8348,8347,8346,8342,8341,8340,8339,8338,8337,8336,8333,8330,8326,8324,8323,8322,8321,8320,8318,8316,8315,8312,8310,8309,8308,8306,8305,8303,8302,8301,8300,8299,8298,8296,8295,8294,8293,8292,8291,8290,8289,8287,8286,8285,8284,8283,8282,8280,8279,8278,8277,8276,8275,8274,8272,8271,8270,8269,8265,8264,8263,8261,8260,8259,8257,8255,8254,8251,8250,8249,8247,8246,8244,8243,8239,8238,8237,8236,8234,8233,8230,8226,8224,8221,8220,8219,8217,8215,8213,8211,8210,8208,8207,8206,8205,8203,8199,8197,8196,8195,8194,8193,8192,8191,8189,8187,8186,8185,8184,8183,8179,8174,8172,8171,8167,8165,8164,8163,8162,8161,8160,8159,8158,8155,8154,8153,8152,8151,8150,8149,8148,8147,8146,8145,8143,8142,8141,8140,8139,8137,8133,8132,8131,8130,8129,8128,8127,8126,8121,8120,8118,8116,8110,8109,8107,8105,8104,8103,8101,8100,8099,8098,8097,8096,8087,8084,8083,8081,8080,8077,8073,8072,8071,8069,8065,8061,8059,8057,8056,8052,8048,8047,8046,8044,8043,8041,8040,8039,8038,8037,8036,8034,8033,8031,8030,8028,8027,8026,8024,8023,8022,8021,8019,8018,8015,8014,8013,8012,8011,8010,8005,8000,7997,7996,7995,7994,7992,7991,7990,7988,7987,7983,7982,7981,7980,7976,7974,7968,7967,7966,7965,7963,7962,7961,7958,7957,7955,7954,7953,7952,7951,7950,7949,7948,7947,7946,7944,7943,7942,7940,7939,7938,7937,7936,7933,7931,7930,7929,7928,7926,7922,7919,7916,7913,7911,7910,7909,7907,7906,7905,7904,7903,7901,7900,7899,7898,7897,7896,7889,7888,7887,7880,7878,7876,7875,7874,7872,7871,7870,7869,7868,7867,7866,7865,7864,7863,7860,7859,7858,7857,7856,7854,7853,7852,7851,7850,7849,7848,7847,7846,7843,7842,7841,7840,7834,7833,7832,7828,7826,7825,7824,7822,7820,7818,7815,7813,7811,7810,7808,7807,7806,7805,7804,7803,7802,7801,7800,7799,7797,7796,7795,7793,7792,7791,7789,7788,7787,7786,7784,7782,7780,7778,7774,7773,7772,7770,7765,7764,7762,7761,7760,7758,7757,7756,7755,7754,7753,7751,7750,7749,7748,7745,7744,7743,7741,7735,7731,7730,7729,7727,7726,7725,7722,7720,7719,7718,7714,7711,7710,7709,7708,7707,7705,7704,7700,7698,7697,7694,7693,7692,7691,7690,7686,7684,7681,7680,7678,7677,7676,7675,7674,7673,7672,7668,7667,7666,7665,7664,7663,7662,7660,7658,7653,7652,7650,7649,7648,7647,7646,7645,7644,7643,7642,7641,7640,7639,7638,7637,7634,7633,7632,7631,7630,7629,7627,7626,7625,7624,7623,7622,7621,7620,7616,7615,7608,7607,7602,7598,7595,7594,7593,7592,7588,7584,7576,7575,7574,7573,7567,7566,7565,7559,7558,7557,7554,7553,7552,7551,7550,7546,7545,7542,7539,7538,7537,7536,7535,7534,7533,7531,7530,7528,7527,7526,7525,7524,7523,7520,7519,7518,7517,7516,7515,7514,7513,7512,7510,7505,7504,7502,7501,7500,7499,7495,7494,7493,7492,7491,7490,7489,7488,7484,7479,7477,7476,7473,7472,7471,7470,7468,7467,7465,7464,7462,7461,7460,7459,7458,7457,7456,7455,7454,7451,7450,7447,7445,7443,7442,7440,7439,7436,7435,7432,7430,7427,7424,7423,7422,7421,7420,7419,7418,7417,7412,7411,7409,7408,7407,7405,7404,7403,7402,7401,7400,7399,7398,7397,7395,7391,7390,7389,7388,7387,7386,7385,7384,7383,7378,7376,7370,7369,7368,7367,7365,7364,7362,7360,7358,7356,7355,7354,7353,7352,7351,7349,7348,7347,7344,7343,7342,7341,7340,7339,7338,7337,7336,7327,7326,7325,7324,7323,7322,7321,7320,7319,7318,7317,7316,7315,7312,7310,7309,7307,7306,7305,7303,7301,7299,7298,7297,7296,7294,7287,7286,7283,7281,7280,7278,7276,7275,7274,7269,7268,7265,7264,7263,7262,7261,7260,7259,7258,7257,7256,7255,7254,7253,7252,7251,7249,7247,7246,7245,7244,7241,7240,7239,7237,7236,7235,7229,7228,7227,7225,7223,7222,7220,7218,7216,7215,7214,7209,7207,7206,7205,7203,7200,7199,7195,7190,7186,7185,7184,7183,7182,7181,7180,7179,7178,7177,7176,7175,7174,7173,7172,7170,7169,7167,7166,7165,7161,7158,7153,7151,7150,7149,7148,7147,7145,7144,7143,7135,7134,7133,7132,7131,7129,7128,7127,7126,7124,7122,7120,7119,7116,7115,7113,7112,7111,7110,7108,7106,7101,7100,7099,7097,7096,7095,7094,7089,7086,7083,7082,7081,7080,7079,7078,7074,7073,7066,7065,7064,7063,7061,7060,7058,7054,7053,7042,7041,7040,7039,7032,7031,7030,7028,7022,7021,7020,7017,7014,7013,7011,7010,7008,7007,7003,7001,6998,6997,6996,6994,6989,6988,6987,6986,6981,6977,6975,6974,6973,6972,6971,6966,6962,6961,6960,6956,6953,6949,6947,6946,6945,6944,6943,6942,6941,6940,6939,6938,6935,6934,6933,6932,6931,6929,6928,6927,6924,6923,6922,6920,6919,6918,6917,6916,6915,6914,6912,6911,6908,6906,6904,6901,6898,6893,6892,6890,6889,6886,6885,6884,6882,6880,6878,6870,6869,6868,6867,6866,6865,6864,6863,6862,6861,6860,6859,6858,6857,6856,6855,6854,6853,6852,6848,6847,6844,6842,6840,6839,6838,6837,6836,6834,6833,6832,6831,6829,6828,6827,6825,6824,6822,6819,6818,6814,6813,6809,6808,6807,6798,6794,6793,6791,6790,6788,6787,6786,6785,6784,6782,6781,6780,6776,6775,6773,6772,6771,6770,6768,6766,6764,6762,6752,6745,6742,6740,6734,6733,6726,6725,6724,6722,6715,6714,6712,6709,6708,6707,6705,6703,6701,6696,6694,6692,6690,6689,6688,6687,6685,6682,6680,6679,6674,6670,6668,6664,6652,6651,6650,6648,6647,6645,6644,6641,6639,6636,6633,6632,6631,6630,6629,6627,6626,6625,6624,6623,6619,6617,6616,6615,6614,6612,6611,6610,6608,6607,6605,6604,6602,6599,6598,6596,6588,6586,6585,6583,6581,6580,6578,6577,6576,6574,6570,6569,6568,6567,6565,6564,6560,6559,6558,6557,6556,6553,6552,6551,6547,6537,6536,6526,6519,6517,6516,6514,6513,6505,6502,6497,6496,6495,6493,6486,6485,6480,6479,6477,6476,6472,6466,6465,6459,6458,6457,6455,6452,6451,6450,6446,6444,6443,6434,6433,6432,6427,6426,6425,6424,6418,6411,6409,6399,6398,6394,6390,6383,6382,6379,6369,6368,6363,6360,6359,6357,6356,6355,6353,6352,6351,6350,6347,6346,6343,6341,6338,6336,6328,6327,6323,6315,6314,6308,6307,6306,6300,6299,6295,6294,6293,6292,6291,6280,6279,6278,6275,6267,6263,6261,6257,6248,6243,6241,6228,6221,6218,6212,6204,6202,6201,6200,6199,6195,6183,6181,6165,6164,6163,6159,6154,6152,6150,6149,6147,6146,6145,6144,6141,6130,6128,6124,6122,6121,6120,6118,6116,6114,6113,6112,6111,6105,6102,6100,6099,6098,6096,6090,6089,6087,6085,6084,6083,6078,6067,6066,6065,6062,6061,6060,6059,6058,6057,6050,6047,6042,6039,6037,6036,6034,6032,6031,6024,6018,6017,6015,6014,6013,6010,6009,6006,6005,6004,6001,5999,5996,5995,5992,5990,5989,5986,5981,5978,5976,5975,5972,5969,5967,5966,5965,5962,5961,5960,5959,5955,5952,5951,5949,5946,5941,5937,5929,5928,5927,5924,5923,5921,5920,5918,5913,5911,5910,5906,5903,5901,5900,5898,5897,5896,5892,5891,5890,5888,5885,5884,5882,5881,5876,5873,5871,5862,5853,5846,5844,5842,5840,5835,5834,5832,5831,5830,5817,5816,5815,5813,5812,5810,5809,5808,5800,5795,5793,5792,5788,5785,5782,5779,5778,5777,5773,5771,5766,5752,5750,5749,5743,5742,5741,5740,5736,5732,5731,5730,5729,5727,5726,5725,5724,5722,5718,5715,5707,5706,5705,5702,5695,5693,5688,5687,5686,5685,5684,5682,5676,5674,5671,5670,5665,5664,5663,5662,5661,5660,5659,5654,5652,5651,5650,5647,5645,5642,5641,5636,5633,5632,5631,5629,5628,5627,5615,5614,5608,5606,5599,5594,5593,5592,5591,5588,5587,5586,5582,5576,5575,5570,5561,5560,5559,5556,5552,5551,5549,5545,5542,5540,5536,5535,5534,5533,5532,5530,5529,5528,5526,5525,5524,5523,5519,5517,5516,5511,5509,5508,5507,5505,5504,5502,5501,5500,5499,5492,5487,5485,5479,5478,5476,5470,5469,5468,5466,5462,5460,5448,5445,5438,5430,5422,5403,5399,5398,5397,5396,5394,5390,5388,5386,5385,5381,5376,5371,5369,5367,5366,5364,5356,5355,5354,5352,5344,5342,5341,5335,5334,5324,5319,5312,5307,5303,5301,5297,5290,5289,5288,5287,5286,5280,5279,5278,5257,5254,5253,5245,5244,5241,5237,5230,5228,5222,5219,5215,5213,5200,5199,5195,5194,5191,5189,5186,5184,5183,5182,5181,5180,5177,5164,5161,5160,5156,5153,5148,5147,5144,5142,5141,5138,5137,5135,5123,5120,5119,5115,5112,5109,5097,5088,5087,5078,5072,5069,5066,5064,5063,5062,5058,5056,5050,5042,5041,5040,5039,5034,5032,5031,5021,5020,5019,5018,5002,5001,5000,4999,4992,4991,4965,4964,4963,4957,4954,4951,4937,4932,4931,4927,4926,4925,4917,4911,4910,4909,4908,4907,4906,4905,4904,4903,4902,4901,4898,4893,4891,4873,4872,4871,4869,4862,4860,4847,4846,4845,4843,4841,4840,4839,4838,4826,4824,4821,4807,4806,4803,4802,4801,4800,4799,4798,4796,4795,4791,4786,4772,4767,4766,4764,4754,4753,4752,4747,4744,4737,4736,4735,4732,4720,4717,4710,4704,4702,4700,4697,4691,4690,4689,4685,4677,4676,4675,4673,4670,4661,4659,4658,4654,4643,4636,4634,4633,4632,4631,4630,4629,4626,4625,4624,4615,4614,4610,4602,4601,4600,4595,4594,4593,4590,4589,4588,4580,4579,4577,4558,4557,4552,4540,4539,4527,4516,4496,4495,4494,4490,4487,4485,4484,4482,4472,4468,4466,4462,4460,4455,4453,4452,4448,4427,4426,4425,4424,4423,4419,4418,4412,4406,4402,4397,4394,4393,4392,4391,4390,4384,4382,4381,4380,4373,4371,4361,4358,4357,4356,4354,4353,4352,4351,4350,4349,4348,4347,4346,4345,4344,4336,4335,4334,4333,4332,4327,4325,4322,4321,4315,4287,4285,4284,4283,4282,4281,4280,4278,4276,4274,4272,4269,4267,4264,4263,4257,4253,4250,4241,4240,4238,4236,4235,4233,4232,4231,4230,4229,4226,4225,4224,4220,4213,4209,4208,4207,4206,4201,4200,4199,4198,4195,4190,4187,4185,4184,4182,4180,4179,4175,4174,4173,4172,4170,4169,4162,4160,4157,4156,4154,4153,4152,4149,4148,4144,4143,4142,4140,4139,4137,4134,4133,4131,4130,4129,4119,4118,4117,4105,4098,4096,4093,4090,4088,4082,4081,4080,4079,4077,4075,4063,4062,4061,4056,4055,4040,4035,4034,4032,4031,4030,4029,4028,4027,4026,4025,4024,4023,4021,4020,4019,4018,4017,4016,4015,4014,4013,4012,4011,4010,4009,4008,4006,4005,4004,4003,4002,4001,4000,3998,3997,3996,3995,3994,3993,3992,3991,3990,3987,3986,3983,3982,3980,3976,3973,3972,3968,3966,3962,3960,3959,3958,3955,3954,3947,3946,3945,3944,3943,3942,3941,3940,3939,3938,3937,3936,3935,3933,3931,3926,3925,3924,3922,3921,3920,3916,3915,3912,3908,3907,3903,3902,3901,3899,3897,3892,3890,3889,3888,3887,3884,3883,3880,3879,3878,3876,3874,3871,3869,3867,3864,3861,3858,3857,3855,3852,3850,3847,3846,3843,3830,3821,3820,3814,3810,3803,3800,3798,3794,3792,3787,3786,3779,3775,3770,3766,3763,3757,3754,3752,3750,3747,3746,3741,3740,3738,3735,3734,3733,3731,3730,3729,3728,3726,3725,3721,3720,3718,3715,3713,3712,3710,3706,3704,3700,3699,3696,3695,3690,3688,3684,3683,3680,3675,3673,3671,3670,3668,3667,3666,3664,3655,3647,3643,3642,3641,3640,3639,3638,3637,3631,3628,3622,3620,3619,3613,3612,3611,3608,3607,3605,3604,3603,3602,3601,3599,3598,3597,3595,3594,3593,3592,3591,3590,3589,3588,3587,3584,3583,3579,3571,3570,3569,3566,3563,3562,3561,3560,3556,3553,3550,3549,3548,3547,3546,3545,3544,3541,3538,3537,3532,3531,3527,3523,3522,3521,3519,3517,3513,3512,3511,3509,3507,3500,3495,3489,3488,3484,3479,3478,3477,3476,3474,3473,3472,3470,3468,3467,3464,3460,3457,3456,3454,3453,3452,3432,3430,3429,3428,3422,3421,3410,3409,3407,3404,3403,3402,3397,3396,3393,3392,3391,3389,3388,3386,3385,3380,3377,3374,3372,3371,3365,3362,3361,3353,3350,3340,3339,3335,3334,3333,3331,3330,3328,3324,3321,3316,3315,3311,3310,3309,3306,3304,3303,3302,3301,3300,3299,3298,3294,3293,3292,3290,3287,3286,3285,3284,3282,3281,3278,3276,3274,3271,3269,3268,3267,3266,3265,3263,3262,3261,3260,3258,3248,3242,3240,3238,3237,3236,3235,3228,3226,3221,3219,3218,3217,3216,3215,3200,3198,3197,3194,3190,3189,3187,3184,3183,3180,3179,3178,3176,3175,3174,3173,3172,3165,3162,3161,3157,3153,3151,3147,3145,3143,3142,3141,3138,3135,3123,3122,3120,3119,3118,3115,3114,3112,3110,3104,3101,3099,3098,3097,3095,3092,3089,3088,3079,3077,3073,3071,3070,3065,3064,3062,3060,3059,3058,3057,3056,3054,3053,3052,3051,3046,3045,3044,3043,3042,3041,3039,3032,3031,3029,3028,3023,3021,3020,3019,3018,3011,3009,3008,3005,3001,2998,2997,2994,2993,2992,2991,2988,2987,2986,2979,2977,2974,2967,2963,2961,2960,2959,2958,2956,2953,2949,2946,2945,2940,2936,2933,2925,2923,2921,2917,2916,2913,2912,2911,2910,2908,2904,2902,2901,2897,2895,2888,2887,2886,2885,2884,2883,2882,2881,2880,2876,2865,2864,2861,2860,2858,2857,2856,2849,2847,2846,2838,2837,2836,2831,2829,2828,2826,2818,2813,2797,2796,2783,2780,2778,2775,2773,2770,2768,2767,2765,2764,2762,2760,2759,2756,2753,2751,2750,2747,2745,2740,2739,2738,2737,2735,2734,2732,2727,2726,2721,2720,2710,2709,2708,2707,2700,2698,2695,2694,2693,2692,2691,2689,2688,2680,2679,2678,2675,2674,2673,2672,2669,2656,2654,2653,2652,2648,2645,2643,2641,2640,2635,2633,2627,2626,2625,2624,2621,2613,2612,2611,2610,2609,2603,2601,2599,2594,2591,2585,2576,2573,2567,2566,2565,2554,2553,2549,2539,2538,2537,2536,2535,2534,2528,2523,2504,2502,2500,2497,2496,2492,2488,2482,2480,2479,2471,2469,2466,2462,2460,2459,2455,2454,2453,2450,2448,2439,2438,2437,2436,2435,2431,2426,2424,2407,2406,2404,2402,2395,2387,2386,2381,2380,2375,2374,2373,2372,2368,2365,2361,2359,2347,2346,2344,2343,2340,2337,2336,2334,2330,2322,2316,2315,2314,2312,2311,2310,2309,2308,2303,2300,2298,2297,2296,2295,2285,2283,2282,2273,2268,2266,2265,2264,2263,2262,2261,2260,2259,2258,2257,2255,2254,2253,2233,2232,2228,2227,2220,2203,2202,2197,2192,2189,2188,2186,2184,2183,2180,2179,2177,2174,2173,2172,2166,2163,2159,2157,2154,2151,2150,2149,2148,2139,2129,2128,2127,2116,2115,2114,2104,2101,2096,2095,2094,2090,2089,2087,2086,2085,2083,2082,2075,2060,2059,2055,2054,2051,2041,2040,2038,2037,2035,2033,2030,2022,2013,2011,2010,2004,1995,1987,1986,1982,1981,1978,1977,1975,1973,1972,1966,1964,1963,1952,1951,1950,1946,1941,1940,1935,1931,1929,1927,1926,1914,1913,1911,1903,1902,1891,1886,1885,1881,1879,1877,1875,1874,1872,1871,1867,1865,1848,1842,1838,1837,1835,1831,1827,1826,1823,1809,1807,1804,1802,1799,1798,1794,1793,1788,1785,1784,1783,1778,1770,1769,1760,1750,1747,1746,1743,1738,1735,1732,1729,1726,1725,1722,1721,1720,1719,1718,1716,1699,1698,1696,1695,1691,1685,1675,1671,1669,1665,1664,1659,1654,1652,1648,1643,1636,1632,1629,1618,1604,1603,1601,1599,1598,1595,1594,1593,1592,1579,1578,1575,1574,1569,1568,1567,1561,1559,1552,1548,1515,1499,1465,1446,1437,1431,1418,1417,1386,1385,1384,1369,1367,1352,1351,1324,1322,1313,1306,1292,1291,1290,1258,1257,1236,1234,1207,1193,1160,1159,1144,1075,1060,1028,1006,1002,992,973,966,947,928,927,903,893,885,882,881,880,878,877,875,873,865,851,816,795,785,775,717,716,715,710,709,708,707,706,705,704,703,702,701,700,696,695,694,693,692,675,668,664,663,641,640,639,638,637,636,635,630,613,612,611,597,596,595,570,568,567,566,565,563,559,558,544,542,470,464,453,430,428,426,398,397,385,374,371,312,297,261,220,214,182,173,78,77,73,68,67,65,64,55,42,18,8722,8711,8710,8698,8690,8689,8687,8671,8659,8658,8655,8649,8646,8642,8632,8631,8628,8622,8616,8604,8603,8597,8594,8577,8570,8562,8561,8545,8537,8534,8531,8528,8520,8511,8510,8509,8504,8503,8500,8480,8478,8474,8471,8470,8458,8457,8453,8431,8419,8416,8415,8414,8413,8408,8406,8405,8398,8384,8379,8375,8373,8352,8344,8343,8335,8332,8329,8327,8325,8317,8314,8313,8304,8297,8281,8273,8262,8256,8253,8252,8245,8242,8241,8240,8232,8229,8228,8225,8223,8216,8214,8209,8200,8198,8190,8180,8175,8173,8170,8169,8168,8144,8136,8135,8124,8117,8115,8114,8112,8108,8102,8085,8078,8076,8066,8063,8051,8029,8025,8017,8016,8007,8004,8003,8002,7998,7993,7989,7986,7979,7977,7970,7969,7964,7956,7945,7941,7935,7927,7925,7924,7917,7914,7912,7908,7902,7895,7894,7893,7892,7890,7883,7879,7855,7844,7839,7838,7836,7823,7821,7819,7817,7812,7794,7769,7763,7752,7742,7723,7721,7717,7712,7706,7703,7701,7699,7695,7688,7687,7671,7670,7669,7661,7659,7628,7619,7618,7617,7614,7613,7606,7605,7604,7603,7601,7600,7599,7596,7590,7589,7587,7572,7564,7563,7562,7560,7556,7555,7549,7548,7540,7532,7529,7522,7509,7508,7498,7487,7485,7483,7482,7480,7478,7444,7441,7438,7437,7433,7431,7429,7426,7415,7406,7396,7394,7382,7363,7359,7346,7345,7333,7332,7331,7330,7329,7328,7313,7311,7302,7300,7295,7289,7288,7282,7279,7271,7270,7250,7248,7243,7231,7230,7226,7224,7221,7217,7213,7212,7211,7210,7204,7202,7192,7171,7168,7164,7163,7162,7159,7156,7142,7141,7137,7136,7123,7121,7118,7117,7104,7098,7077,7076,7075,7071,7068,7062,7059,7052,7046,7045,7044,7033,7024,7016,7012,7009,7004,7002,6995,6984,6983,6982,6980,6979,6976,6969,6967,6965,6964,6963,6959,6957,6954,6948,6936,6926,6921,6905,6897,6896,6894,6888,6874,6851,6850,6849,6845,6835,6830,6821,6820,6806,6804,6803,6802,6801,6789,6778,6777,6767,6765,6763,6761,6760,6759,6758,6756,6755,6754,6748,6744,6743,6739,6738,6737,6732,6730,6718,6717,6713,6710,6706,6704,6700,6699,6698,6684,6677,6676,6675,6663,6662,6661,6658,6657,6656,6646,6634,6628,6618,6613,6595,6590,6584,6582,6575,6573,6572,6571,6563,6550,6541,6540,6529,6528,6527,6525,6524,6523,6521,6515,6512,6511,6506,6504,6494,6492,6491,6490,6489,6484,6483,6482,6481,6478,6475,6474,6473,6471,6469,6462,6456,6449,6448,6445,6442,6437,6436,6417,6416,6413,6408,6396,6393,6392,6391,6385,6381,6378,6372,6371,6367,6366,6362,6358,6349,6348,6345,6342,6340,6337,6333,6330,6329,6326,6321,6320,6311,6310,6298,6290,6286,6285,6277,6273,6269,6268,6265,6262,6256,6255,6254,6252,6249,6247,6246,6245,6229,6213,6189,6188,6186,6185,6184,6182,6178,6177,6174,6169,6168,6166,6161,6143,6135,6134,6131,6127,6123,6115,6110,6109,6108,6104,6101,6097,6086,6081,6071,6051,6048,6035,6030,6028,6021,6020,6019,6016,6008,6007,6003,6002,6000,5998,5993,5985,5984,5983,5974,5971,5968,5963,5956,5954,5953,5950,5943,5936,5935,5934,5931,5917,5915,5912,5905,5895,5887,5883,5879,5875,5874,5872,5869,5866,5865,5864,5860,5859,5847,5843,5839,5837,5836,5820,5819,5818,5805,5802,5801,5799,5798,5794,5781,5768,5767,5764,5763,5762,5761,5760,5753,5748,5747,5735,5733,5721,5713,5701,5700,5683,5680,5678,5672,5667,5657,5653,5646,5644,5643,5640,5639,5634,5630,5626,5613,5612,5611,5610,5598,5596,5585,5584,5583,5581,5577,5574,5573,5571,5564,5562,5553,5550,5548,5547,5544,5541,5521,5514,5512,5506,5495,5494,5493,5491,5486,5483,5471,5467,5463,5461,5457,5456,5455,5452,5450,5449,5441,5436,5435,5434,5429,5410,5405,5400,5395,5393,5382,5380,5379,5378,5375,5372,5368,5358,5357,5353,5351,5350,5348,5347,5345,5340,5339,5336,5328,5326,5322,5316,5315,5309,5300,5295,5294,5261,5260,5259,5258,5256,5252,5251,5249,5248,5246,5234,5211,5210,5206,5179,5178,5162,5157,5155,5151,5143,5140,5132,5128,5126,5124,5122,5121,5116,5095,5083,5068,5067,5060,5059,5057,5049,5043,5038,5037,5035,5024,5016,5012,5011,5008,5007,5006,4996,4989,4988,4987,4986,4985,4984,4983,4981,4978,4974,4971,4970,4960,4959,4952,4947,4946,4945,4944,4943,4938,4936,4930,4928,4922,4915,4914,4899,4897,4896,4885,4866,4864,4856,4855,4851,4850,4849,4835,4832,4831,4830,4829,4823,4794,4785,4778,4771,4769,4746,4745,4733,4731,4719,4718,4715,4714,4707,4706,4705,4694,4693,4684,4678,4669,4668,4665,4657,4652,4651,4650,4649,4648,4640,4628,4618,4608,4597,4591,4586,4585,4582,4573,4569,4567,4561,4560,4556,4548,4541,4530,4526,4524,4515,4514,4513,4503,4502,4501,4476,4457,4449,4446,4430,4428,4420,4415,4413,4396,4388,4379,4364,4355,4343,4342,4339,4338,4326,4307,4306,4291,4290,4279,4275,4273,4265,4262,4259,4258,4251,4248,4245,4243,4227,4219,4217,4212,4203,4197,4189,4171,4167,4165,4161,4155,4100,4091,4086,4072,4070,4069,4051,4048,4042,4038,4033,4007,3999,3985,3970,3953,3932,3930,3929,3927,3918,3917,3905,3900,3896,3895,3893,3882,3877,3873,3868,3863,3862,3854,3849,3844,3831,3829,3825,3796,3791,3790,3789,3784,3782,3777,3774,3769,3756,3748,3743,3739,3737,3736,3724,3708,3707,3702,3691,3685,3682,3678,3677,3676,3672,3669,3652,3651,3649,3636,3635,3625,3624,3623,3618,3614,3610,3578,3554,3542,3533,3529,3525,3524,3505,3501,3497,3496,3494,3492,3466,3462,3417,3413,3408,3390,3387,3384,3382,3376,3375,3368,3363,3345,3343,3341,3329,3308,3295,3291,3277,3264,3251,3245,3243,3234,3233,3230,3229,3223,3214,3212,3211,3208,3206,3201,3195,3192,3191,3188,3177,3163,3150,3148,3140,3139,3137,3136,3116,3113,3111,3109,3108,3094,3090,3087,3085,3083,3082,3081,3075,3061,3050,3049,3048,3034,3030,3016,3015,3010,3004,2995,2990,2985,2984,2981,2978,2975,2972,2969,2968,2966,2951,2948,2932,2928,2922,2919,2906,2903,2899,2892,2890,2875,2869,2863,2862,2845,2833,2827,2824,2821,2811,2809,2804,2802,2801,2794,2788,2766,2761,2749,2730,2729,2723,2722,2718,2713,2712,2699,2684,2677,2661,2659,2658,2651,2642,2637,2608,2604,2602,2590,2586,2584,2575,2562,2560,2529,2520,2510,2507,2501,2499,2493,2486,2461,2434,2423,2420,2418,2416,2411,2405,2400,2398,2397,2393,2383,2371,2370,2366,2345,2329,2323,2318,2313,2304,2294,2286,2277,2276,2275,2267,2251,2244,2242,2241,2230,2229,2212,2200,2194,2181,2171,2153,2147,2143,2141,2126,2123,2117,2106,2103,2102,2093,2092,2070,2045,2029,2023,2020,2019,2014,2009,2008,1999,1993,1989,1961,1956,1928,1925,1920,1895,1876,1862,1860,1851,1844,1833,1812,1810,1796,1792,1787,1779,1777,1776,1773,1756,1740,1734,1733,1731,1724,1704,1693,1674,1668,1656,1653,1646,1635,1626,1624,1610,1609,1608,1602,1600,1597,1591,1590,1589,1587,1583,1581,1580,1572,1554,1549,1520,1485,1477,1445,1442,1408,1388,1355,1345,1335,1334,1319,1309,1307,1305,1304,1303,1283,1273,1253,1214,1210,1186,1176,1174,1142,1128,1097,1078,1067,1064,1054,1047,1001,962,948,940,934,930,926,925,913,897,860,845,798,773,760,751,723,714,699,698,697,662,660,650,642,633,618,588,500,498,472,421,416,373,372,343,327,245,118,8700,8651,8647,8608,8576,8552,8505,8468,8466,8454,8434,8433,8430,8418,8396,8368,8351,8350,8349,8345,8328,8311,8307,8288,8268,8231,8218,8212,8188,8177,8166,8157,8134,8113,8111,8092,8090,8089,8088,8082,8079,8070,8068,8067,8064,8055,8045,8042,7972,7923,7920,7918,7877,7845,7798,7785,7779,7747,7740,7713,7702,7696,7636,7610,7609,7583,7581,7578,7571,7570,7561,7547,7544,7511,7507,7506,7486,7481,7466,7453,7448,7428,7392,7381,7380,7379,7377,7375,7374,7373,7372,7357,7350,7314,7293,7292,7284,7273,7267,7266,7233,7232,7219,7197,7196,7193,7160,7155,7154,7152,7146,7140,7138,7125,7107,7093,7091,7070,7067,7050,7043,7036,7027,7026,7025,7006,6978,6968,6937,6930,6925,6913,6910,6900,6895,6876,6871,6846,6843,6841,6811,6805,6800,6792,6779,6774,6753,6691,6681,6671,6659,6655,6635,6603,6593,6592,6591,6549,6548,6544,6543,6535,6509,6507,6503,6500,6499,6488,6487,6468,6467,6440,6439,6430,6423,6422,6407,6406,6405,6397,6395,6388,6384,6380,6365,6364,6361,6331,6322,6316,6302,6301,6296,6289,6288,6284,6283,6264,6253,6244,6242,6237,6236,6230,6219,6217,6216,6215,6198,6193,6170,6167,6133,6119,6117,6094,6080,6077,6074,6073,6068,6056,6040,6033,6026,6023,6022,5994,5991,5979,5970,5957,5948,5940,5939,5930,5926,5919,5904,5877,5868,5852,5851,5848,5811,5796,5791,5786,5783,5780,5769,5765,5759,5745,5739,5738,5717,5711,5698,5696,5692,5689,5666,5658,5637,5623,5620,5619,5616,5590,5589,5579,5568,5566,5565,5554,5546,5543,5539,5537,5518,5496,5490,5482,5473,5464,5458,5447,5443,5425,5413,5412,5411,5408,5406,5401,5384,5383,5365,5361,5338,5337,5330,5325,5311,5310,5276,5274,5271,5268,5267,5262,5255,5250,5242,5240,5239,5233,5232,5231,5227,5214,5205,5197,5171,5152,5129,5117,5103,5102,5099,5090,5081,5076,5074,5027,5009,4994,4993,4990,4969,4962,4958,4956,4942,4933,4929,4895,4890,4889,4854,4820,4816,4815,4814,4813,4811,4810,4809,4805,4793,4792,4787,4782,4780,4773,4759,4758,4741,4734,4730,4729,4728,4703,4682,4671,4664,4662,4644,4616,4603,4599,4587,4568,4564,4553,4551,4542,4506,4504,4500,4493,4491,4486,4471,4467,4459,4458,4442,4441,4440,4434,4416,4404,4403,4377,4372,4369,4340,4324,4311,4304,4295,4286,4266,4247,4244,4234,4228,4222,4221,4218,4204,4194,4193,4192,4183,4168,4164,4159,4138,4124,4116,4114,4112,4085,4084,4074,4073,4047,4044,3951,3934,3928,3906,3898,3886,3885,3860,3856,3853,3845,3839,3833,3827,3806,3805,3788,3773,3760,3755,3751,3749,3745,3722,3716,3705,3694,3692,3656,3606,3568,3565,3559,3557,3551,3528,3526,3514,3508,3491,3487,3469,3459,3458,3445,3436,3431,3418,3406,3383,3366,3352,3323,3314,3256,3250,3247,3181,3166,3164,3152,3146,3134,3130,3117,3096,3080,3078,3027,3000,2965,2962,2955,2926,2905,2894,2893,2891,2877,2873,2843,2816,2814,2795,2790,2786,2774,2758,2731,2728,2725,2717,2716,2696,2676,2671,2666,2663,2662,2639,2638,2630,2617,2589,2578,2577,2564,2561,2547,2532,2526,2521,2518,2517,2514,2495,2478,2465,2441,2413,2409,2382,2369,2357,2350,2326,2299,2280,2271,2239,2235,2211,2204,2182,2176,2119,2078,2077,2069,2049,2028,2015,2007,1996,1922,1908,1901,1888,1884,1880,1857,1819,1806,1765,1764,1745,1705,1677,1667,1628,1620,1560,1550,1517,1516,1500,1481,1444,1422,1419,1372,1368,1331,1323,1320,1317,1289,1282,1266,1254,1250,1248,1221,1217,1215,1182,1117,1096,1082,1081,1051,1012,998,922,900,883,879,870,839,833,831,654,631,599,493,485,437,434,155,8719,8718,8714,8709,8703,8694,8683,8645,8636,8512,8498,8476,8407,8388,8334,8331,8258,8248,8235,8202,8201,8181,8178,8176,8123,8122,8106,8093,8091,8062,8060,8053,8050,8049,8035,8001,7984,7973,7891,7886,7882,7881,7861,7835,7814,7777,7771,7767,7738,7737,7689,7685,7682,7657,7635,7612,7611,7597,7591,7580,7568,7543,7410,7371,7366,7361,7335,7334,7308,7304,7291,7290,7285,7277,7272,7201,7198,7194,7191,7157,7139,7130,7114,7102,7057,7056,7049,7015,6999,6992,6991,6985,6958,6950,6907,6887,6881,6875,6872,6826,6823,6817,6799,6797,6795,6769,6757,6749,6746,6736,6728,6727,6719,6716,6702,6697,6695,6686,6683,6666,6665,6638,6622,6579,6566,6562,6546,6542,6539,6532,6530,6522,6508,6470,6460,6453,6441,6431,6412,6403,6402,6400,6389,6376,6375,6374,6373,6354,6344,6318,6313,6312,6281,6259,6251,6209,6208,6205,6191,6176,6173,6162,6151,6148,6142,6136,6129,6125,6107,6069,6052,6049,5982,5945,5944,5933,5932,5909,5908,5889,5878,5861,5858,5856,5855,5845,5829,5828,5824,5823,5789,5787,5755,5754,5746,5737,5723,5709,5655,5648,5638,5621,5618,5617,5601,5595,5580,5557,5498,5497,5484,5475,5474,5465,5415,5414,5404,5373,5349,5346,5332,5313,5305,5293,5284,5282,5269,5226,5225,5224,5221,5204,5201,5196,5192,5166,5158,5149,5131,5114,5108,5107,5101,5094,5093,5092,5089,5082,5071,5061,5054,5048,5033,5023,5015,4995,4979,4975,4950,4940,4939,4934,4916,4900,4886,4881,4879,4876,4848,4842,4804,4797,4781,4779,4777,4739,4738,4721,4716,4709,4708,4699,4687,4666,4663,4660,4656,4641,4638,4637,4596,4571,4563,4549,4536,4534,4528,4519,4509,4498,4438,4433,4422,4421,4398,4395,4387,4375,4370,4365,4341,4337,4330,4302,4298,4294,4293,4277,4261,4260,4205,4158,4109,4108,4099,4067,4057,4037,3911,3834,3815,3793,3772,3765,3686,3646,3627,3616,3615,3600,3596,3574,3572,3564,3539,3536,3504,3490,3483,3482,3465,3461,3448,3435,3395,3379,3364,3358,3351,3312,3254,3246,3244,3241,3213,3210,3205,3203,3202,3182,3168,3167,3155,3149,3133,3132,3106,3105,3086,3067,2976,2938,2935,2930,2924,2907,2879,2878,2871,2848,2841,2839,2787,2763,2755,2754,2748,2746,2736,2703,2701,2697,2664,2660,2655,2650,2632,2622,2620,2619,2600,2598,2597,2572,2571,2558,2550,2533,2525,2516,2515,2505,2498,2443,2433,2417,2410,2403,2394,2392,2385,2384,2335,2328,2302,2301,2279,2278,2256,2252,2236,2223,2217,2178,2146,2124,2112,2088,2073,2058,2053,2043,2001,1988,1965,1953,1937,1930,1904,1847,1834,1803,1763,1742,1737,1680,1661,1651,1633,1630,1627,1596,1588,1586,1585,1577,1564,1546,1524,1521,1489,1469,1459,1420,1405,1394,1364,1357,1348,1344,1341,1268,1225,1209,1194,1181,1173,1163,1099,1003,989,977,976,969,921,866,820,819,776,756,753,750,735,610,580,517,510,326,151,144,81,8074,7934,7790,7746,7716,7072,6673,6420,6419,6410,6401,6260,6138,6088,6041,5814,5690,5407,5270,5106,5080,4362,4022,3797,3758,3648,3580,3369,3367,3296,3257,3227,3131,3127,3107,3093,3055,2971,2822,2772,2657,2527,2449,2390,2317,2003,1998,1985,1979,1949,1938,1878,1730,1728,1692,1679,1570,1562,1237,1192,608,550,495,381,367,8138,8020,7837,7759,7656,7242,6990,6747,6461,6438,6387,5299,5188,3957,3555,3486,3475,3207,3126,3091,3074,3037,2840,2825,2798,2779,2741,1854,1707,1649,1634,1584,1079,889,749,7018,6421,6370,5958,5220,5139,3698,3697,3621,3289,3224,3128,2874,2644,2379,2354,2118,1957,1948,1873,876,685,384,8182,8032,7733,7651,7088,6464,6463,6415,6386,6235,6207,6206,6179,3709,3687,3516,3394,3305,3225,3076,3072,2970,2853,2615,2432,2325,2062,1768,1759,1657,1619,761,429,332,6951,6783,6428,5392,3910,3875,3872,3444,3185,3129,2915,2810,2808,2649,2364,2071,1830,1658,1565,1488,7862,2574,2319,1758,1638,1110,6404,4543,3650,1991,1939,1694,899,768,427,117,6729,6239,5100,3778,3515,3063,884,627,609,7932,5343,1700,1660,514,3447,2563,2530,1864,1797,1566,939,3866,2342,1829,413,7238,3084,2771,2068,1947,1563,3433,8584,7092,3776,1571,5886,320,7425,1890,2614,3471,47,380,3799,3373,2868,1790,1853,543,7087,1805,74,3904,69,644,1832,532,1642,2162,1688,763,1791,133,2348,154,7208,643,1573,393,417,1889,1772,1645,411,330,274,1801,116,103,383,70,298,329,418,63,447,557,379,115,119,382,192,25,24,126,21,19,17]
lista_acordes_invalidos_2 = []
for i in lista_indice_acordes_invalidos:
    lista_acordes_invalidos_2.append(df_cifras_count.iloc[i]["index"])
    print(i)

# limpeza: eliminando invalidos das cifras
df_analise_cifras["cifra_list_filtrada"] = df_analise_cifras["cifra_list"].apply(lambda x: [item for item in x if item not in lista_acordes_invalidos_2])

# limpeza: padronizando
def replace_cifra(x):
    y = []
    for j in x:
        j = j.replace("?","dim").replace("º","dim").replace("o","dim").replace("aum","+")
        y.append(j)
    return y

df_analise_cifras["cifra_list_padronizada"] = df_analise_cifras["cifra_list_filtrada"].map(replace_cifra)

n=0
for i in range(0,len(df_analise_cifras)):
    if len(df_analise_cifras.iloc[i]["cifra_list_padronizada"]) < 3:
        n += 1
        print(df_analise_cifras.iloc[i]["artista"]+", "+str(n)+", "+str(i))

df_analise_cifras_2 = df_analise_cifras[df_analise_cifras["cifra_list_padronizada"].str.len() > 2]



# criando colunas com métricas de cifra
df_analise_cifras_2["qtde_acordes"] = df_analise_cifras_2["cifra_list_padronizada"].map(tamanho_lista)
df_analise_cifras_2["qtde_acordes_distintos"] = df_analise_cifras_2["cifra_list_padronizada"].map(tamanho_lista_unicos)

# calculando tf-idf da cifra
acordes_geral = []
for i in range(0,len(df_analise_cifras_2)):
    for j in range(0,len(df_analise_cifras_2.iloc[i]["cifra_list_padronizada"])):
        acordes_geral.append(df_analise_cifras_2.iloc[i]["cifra_list_padronizada"][j])
    print(i)

acordes_geral_dict = dict(Counter(acordes_geral))

def count_acorde(x):
    y = []    
    for j in x:
        count = acordes_geral_dict.get(j)
        y.append(count)
    return y

def count_acorde_intra(x):
    y = []    
    for j in x:
        count = x.count(j)
        y.append(count)
    return y

df_analise_cifras_2["acordario_idf"] = df_analise_cifras_2["cifra_list_padronizada"].map(count_acorde)
df_analise_cifras_2["acordario_tf"] = df_analise_cifras_2["cifra_list_padronizada"].map(count_acorde_intra)
df_analise_cifras_2["acordario_idf_array"] = df_analise_cifras_2["acordario_idf"].map(coluna_array)
df_analise_cifras_2["acordario_tf_array"] = df_analise_cifras_2["acordario_tf"].map(coluna_array)
df_analise_cifras_2["acordario_tf_idf_array"] = df_analise_cifras_2["acordario_tf_array"]/df_analise_cifras_2["acordario_idf_array"]
df_analise_cifras_2['acordario_tf_idf_mean'] = df_analise_cifras_2["acordario_tf_idf_array"].map(array_mean)

# cifras: criando listas com acordes por campo harmonico
# ch_do_maior = ["C","Dm","Em","F","G","Am","Bm(b5)","Am7","Dm6","G7","C7M","Dm7","Em7","F7M","G7","Am7","Bm7(b5)"]
# ch_sol_maior = ["G","Am","Bm","C","D","Em","F#m(b5)","Em7","Am6","D7","G7M","Am7","Bm7","C7M","D7","Em7","F#m7(b5)"]
# ch_re_maior = ["D","Em","F#m","G","A","Bm","C#m(b5)","Bm7","Em6","A7","D7M","","Em7","F#m7","G7M","C#m7(b5)"]
# ch_la_maior = ["A","Bm","C#m","D","E","F#m","G#m(b5)","F#m7","Bm6","E7","G#m7(b5)","Bm7","C#m7"]
# ch_mi_maior = ["E","F#m","G#m","A","B","C#m","D#m(b5)","C#m7","F#m6","B7","E7M","F#m7","G#m7","A7M","C#m7","D#m(b5)"]
# ch_si_maior = ["B","C#m","D#m","E","F#","G#m","A#m(b5)","G#m7","C#m6","B7M","C#m7","D#m7","E7M","F#7","G#m7","A#m(b5)"]
# ch_fa_sus_maior = ["","","","","","","","",""]

# cifras: tamanho dos acordes
def tamanho_strings(x):
    y = []
    for j in x:
        _len = len(j)
        y.append(_len)
    return y

df_analise_cifras_2["lista_tamanho_acordes"] = df_analise_cifras_2["cifra_list_padronizada"].map(tamanho_strings)
df_analise_cifras_2["lista_tamanho_acordes_array"] = df_analise_cifras_2["lista_tamanho_acordes"].map(coluna_array)
df_analise_cifras_2['tamanho_acordes_mean'] = df_analise_cifras_2["lista_tamanho_acordes_array"].map(array_mean)

# Artistas: base consolidada de métricas 1
df_analise_artista = df_analise_letras_filtrado.groupby(["artista", "genero_ajustado"], as_index=False).agg({"nome_musica": pd.Series.nunique,
                                                                                                                              "vocabulario_full_tf_idf_mean": "mean",
                                                                                                                              "qtde_palavras": "mean",
                                                                                                                              "qtde_palavras_distintas": "mean"})
df_analise_cifras_2_agrupado = df_analise_cifras_2.groupby(["artista"], as_index=False).agg({"qtde_acordes": "mean",
                                                                                              "qtde_acordes_distintos": "mean",
                                                                                              "acordario_tf_idf_mean": "mean",
                                                                                              "tamanho_acordes_mean": "mean",
                                                                                              })

df_analise_artista = pd.merge(df_analise_artista, df_analise_cifras_2_agrupado, on='artista', how='inner')
df_analise_artista["perc_acordes_distintos"] = df_analise_artista["qtde_acordes_distintos"]/df_analise_artista["qtde_acordes"]
df_analise_artista["perc_palavras_distintas"] = df_analise_artista["qtde_palavras_distintas"]/df_analise_artista["qtde_palavras"]
df_analise_artista["soma_tf_idf"] = df_analise_artista["acordario_tf_idf_mean"] + df_analise_artista["vocabulario_full_tf_idf_mean"]

# Artistas: criando acordario completo e vocabulario completo
# Vocabulario completo
lista_vocabularios = []
n = 0
for artista in list(df_analise_artista["artista"]):
   n += 1
   lista_artista = []
   for i in range(0,len(df_analise_letras_filtrado[df_analise_letras_filtrado['artista'] == artista])):
       lista_artista = lista_artista + df_analise_letras_filtrado[df_analise_letras_filtrado['artista'] == artista].iloc[i]["letra_vocabulario_full"]
   lista_vocabularios.append((artista,) + tuple([lista_artista]))
   print(n)

df_artista_vocabularios = pd.DataFrame.from_records(lista_vocabularios, columns=["artista","vocabulario_completo"])
            
            
# Acordario completo
lista_acordarios = []
n = 0
for artista in list(df_analise_artista["artista"]):
   n += 1
   lista_artista = []
   for i in range(0,len(df_analise_cifras_2[df_analise_cifras_2['artista'] == artista])):
       lista_artista = lista_artista + df_analise_cifras_2[df_analise_cifras_2['artista'] == artista].iloc[i]["cifra_list_padronizada"]
   lista_acordarios.append((artista,) + tuple([lista_artista]))
   print(n)

df_artista_acordarios = pd.DataFrame.from_records(lista_acordarios, columns=["artista","acordario_completo"])         
            
# Novas metricas
df_analise_artista = pd.merge(pd.merge(df_analise_artista, df_artista_vocabularios, on='artista', how='inner'), df_artista_acordarios, on='artista', how='inner')
df_analise_artista['qtde_palavras_vocabulario_completo'] = df_analise_artista["vocabulario_completo"].map(tamanho_lista)
df_analise_artista['qtde_palavras_unicas_vocabulario_completo'] = df_analise_artista["vocabulario_completo"].map(tamanho_lista_unicos)
df_analise_artista['qtde_acordes_acordario_completo'] = df_analise_artista["acordario_completo"].map(tamanho_lista)
df_analise_artista['qtde_acordes_unicas_acordario_completo'] = df_analise_artista["acordario_completo"].map(tamanho_lista_unicos)
df_analise_artista["artista_perc_palavras_distintas"] = df_analise_artista["qtde_palavras_unicas_vocabulario_completo"]/df_analise_artista["qtde_palavras_vocabulario_completo"]
df_analise_artista["artista_perc_acordes_distintos"] = df_analise_artista["qtde_acordes_unicas_acordario_completo"]/df_analise_artista["qtde_acordes_acordario_completo"]

df_analise_artista["lista_tamanho_acordes_completo"] = df_analise_artista["acordario_completo"].map(tamanho_strings)
df_analise_artista["lista_tamanho_acordes_completo_array"] = df_analise_artista["lista_tamanho_acordes_completo"].map(coluna_array)
df_analise_artista['tamanho_acordes_completo_mean'] = df_analise_artista["lista_tamanho_acordes_completo_array"].map(array_mean)


df_analise_artista["artista_vocabulario_completo_idf"] = df_analise_artista["vocabulario_completo"].map(count_word)
df_analise_artista["artista_vocabulario_completo_tf"] = df_analise_artista["vocabulario_completo"].map(count_word_intra)
df_analise_artista["artista_vocabulario_completo_idf_array"] = df_analise_artista["artista_vocabulario_completo_idf"].map(coluna_array)
df_analise_artista["artista_vocabulario_completo_tf_array"] = df_analise_artista["artista_vocabulario_completo_tf"].map(coluna_array)
df_analise_artista["artista_vocabulario_completo_tf_idf_array"] = df_analise_artista["artista_vocabulario_completo_tf_array"]/df_analise_artista["artista_vocabulario_completo_idf_array"]
df_analise_artista['artista_vocabulario_completo_tf_idf_mean'] = df_analise_artista["artista_vocabulario_completo_tf_idf_array"].map(array_mean)


df_analise_artista["artista_acordario_completo_idf"] = df_analise_artista["acordario_completo"].map(count_acorde)
df_analise_artista["artista_acordario_completo_tf"] = df_analise_artista["acordario_completo"].map(count_acorde_intra)
df_analise_artista["artista_acordario_completo_idf_array"] = df_analise_artista["artista_acordario_completo_idf"].map(coluna_array)
df_analise_artista["artista_acordario_completo_tf_array"] = df_analise_artista["artista_acordario_completo_tf"].map(coluna_array)
df_analise_artista["artista_acordario_completo_tf_idf_array"] = df_analise_artista["artista_acordario_completo_tf_array"]/df_analise_artista["artista_acordario_completo_idf_array"]
df_analise_artista['artista_acordario_completo_tf_idf_mean'] = df_analise_artista["artista_acordario_completo_tf_idf_array"].map(array_mean)


# Ajustes
list(df_analise_artista)
df_analise_artista_resumo = df_analise_artista.iloc[:, [0,1,2,3,4,5,6,7,8,9,10,11,12,15,16,17,18,24,30]]
df_analise_artista = df_analise_artista[~df_analise_artista["artista"].isin(['corinhos-evangelicos', 'dominio-publico', 'israel-e-rodolffo', 'bambakere', 'morais-do-acordeon', 'almir-bezerra', 'sepultura', 'nomad', 'angra', 'paulinho-natureza', 'rappervil', 'ricardo-braga', 'terrasamba', 'matogrosso-e-mathias', 'marconi-branco', 'salomao-do-reggae', 'cagerio-de-souza', 'paralamas-do-sucesso', 'kelvin-do-acordeom', 'brenda-lee'])]
df_analise_artista.set_value(273, 'genero_ajustado', "MPB")
df_analise_artista_resumo = df_analise_artista.iloc[:, [0,1,2,3,4,5,6,7,8,9,10,11,12,15,16,17,18,24,30,31,32,35]]

# Novas metricas (escala 0-1)
list(df_analise_artista_resumo)
df_analise_artista_resumo.rename(columns = {'nome_musica':'qtde_musicas'}, inplace = True)
df_analise_artista_resumo["qtde_musicas_escala"] = (df_analise_artista_resumo["qtde_musicas"]-min(df_analise_artista_resumo["qtde_musicas"]))/(max(df_analise_artista_resumo["qtde_musicas"])-min(df_analise_artista_resumo["qtde_musicas"]))
df_analise_artista_resumo["qtde_palavras_vocabulario_completo_escala"] = (df_analise_artista_resumo["qtde_palavras_vocabulario_completo"]-min(df_analise_artista_resumo["qtde_palavras_vocabulario_completo"]))/(max(df_analise_artista_resumo["qtde_palavras_vocabulario_completo"])-min(df_analise_artista_resumo["qtde_palavras_vocabulario_completo"]))
df_analise_artista_resumo["qtde_palavras_unicas_vocabulario_completo_escala"] = (df_analise_artista_resumo["qtde_palavras_unicas_vocabulario_completo"]-min(df_analise_artista_resumo["qtde_palavras_unicas_vocabulario_completo"]))/(max(df_analise_artista_resumo["qtde_palavras_unicas_vocabulario_completo"])-min(df_analise_artista_resumo["qtde_palavras_unicas_vocabulario_completo"]))
df_analise_artista_resumo["artista_perc_palavras_distintas_escala"] = (df_analise_artista_resumo["artista_perc_palavras_distintas"]-min(df_analise_artista_resumo["artista_perc_palavras_distintas"]))/(max(df_analise_artista_resumo["artista_perc_palavras_distintas"])-min(df_analise_artista_resumo["artista_perc_palavras_distintas"]))
df_analise_artista_resumo["artista_vocabulario_completo_tf_idf_mean_escala"] = (df_analise_artista_resumo["artista_vocabulario_completo_tf_idf_mean"]-min(df_analise_artista_resumo["artista_vocabulario_completo_tf_idf_mean"]))/(max(df_analise_artista_resumo["artista_vocabulario_completo_tf_idf_mean"])-min(df_analise_artista_resumo["artista_vocabulario_completo_tf_idf_mean"]))


df_analise_artista_resumo["qtde_acordes_acordario_completo_escala"] = (df_analise_artista_resumo["qtde_acordes_acordario_completo"]-min(df_analise_artista_resumo["qtde_acordes_acordario_completo"]))/(max(df_analise_artista_resumo["qtde_acordes_acordario_completo"])-min(df_analise_artista_resumo["qtde_acordes_acordario_completo"]))
df_analise_artista_resumo["qtde_acordes_unicas_acordario_completo_escala"] = (df_analise_artista_resumo["qtde_acordes_unicas_acordario_completo"]-min(df_analise_artista_resumo["qtde_acordes_unicas_acordario_completo"]))/(max(df_analise_artista_resumo["qtde_acordes_unicas_acordario_completo"])-min(df_analise_artista_resumo["qtde_acordes_unicas_acordario_completo"]))
df_analise_artista_resumo["artista_perc_acordes_distintos_escala"] = (df_analise_artista_resumo["artista_perc_acordes_distintos"]-min(df_analise_artista_resumo["artista_perc_acordes_distintos"]))/(max(df_analise_artista_resumo["artista_perc_acordes_distintos"])-min(df_analise_artista_resumo["artista_perc_acordes_distintos"]))
df_analise_artista_resumo["tamanho_acordes_completo_mean_escala"] = (df_analise_artista_resumo["tamanho_acordes_completo_mean"]-min(df_analise_artista_resumo["tamanho_acordes_completo_mean"]))/(max(df_analise_artista_resumo["tamanho_acordes_completo_mean"])-min(df_analise_artista_resumo["tamanho_acordes_completo_mean"]))
df_analise_artista_resumo["artista_acordario_completo_tf_idf_mean_escala"] = (df_analise_artista_resumo["artista_acordario_completo_tf_idf_mean"]-min(df_analise_artista_resumo["artista_acordario_completo_tf_idf_mean"]))/(max(df_analise_artista_resumo["artista_acordario_completo_tf_idf_mean"])-min(df_analise_artista_resumo["artista_acordario_completo_tf_idf_mean"]))

df_analise_artista_resumo["score_artista_cifra"] =  df_analise_artista_resumo["qtde_acordes_unicas_acordario_completo_escala"] + df_analise_artista_resumo["artista_perc_acordes_distintos_escala"] + df_analise_artista_resumo["tamanho_acordes_completo_mean_escala"] + df_analise_artista_resumo["artista_acordario_completo_tf_idf_mean_escala"]

df_analise_artista_resumo["score_artista_letra"] = df_analise_artista_resumo["qtde_musicas_escala"] + df_analise_artista_resumo["qtde_palavras_unicas_vocabulario_completo_escala"] + df_analise_artista_resumo["artista_perc_palavras_distintas_escala"] + df_analise_artista_resumo["artista_vocabulario_completo_tf_idf_mean_escala"]

df_analise_artista_resumo["score_artista_final"] = df_analise_artista_resumo["score_artista_cifra"] + df_analise_artista_resumo["score_artista_letra"]




    

